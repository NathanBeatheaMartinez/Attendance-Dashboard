<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="color-scheme" content="light dark">
    <title>Fiscal Year Attendance Dashboard</title>

    <!-- Inter Font – the gold standard for dashboards in 2025 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #1e3a8a;
            --primary-light: #4a90e2;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .dark-mode {
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --bg: #0f172a;
            --card: #1e293b;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.4);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            transition: background 0.3s ease;
        }
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary);
            color: white;
            padding: 8px;
            border-radius: 0 0 6px 6px;
            z-index: 1000;
        }
        .skip-link:focus { top: 0; }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--card);
            padding: 32px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 32px;
            text-align: center;
            position: relative;
        }
        .header h1 {
            font-size: 2.6rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .subtitle { color: var(--text-light); font-size: 1.1rem; margin-bottom: 24px; }

        /* Theme Toggle */
        #themeToggle {
            position: absolute;
            top: 20px;
            right: 24px;
            background: none;
            border: none;
            font-size: 1.6rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        #themeToggle:hover { background: rgba(30,58,138,.1); }

        .year-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin: 24px 0;
        }
        .year-btn {
            padding: 12px 28px;
            font-weight: 600;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .year-btn:hover { background: #e0e7ff; }
        .year-btn.active, .dark-mode .year-btn.active {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
        }

        .date-range-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        .date-input {
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
        }
        .date-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(78,144,226,.2);
        }
        .apply-btn, .clear-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .apply-btn { background: var(--primary); color: white; }
        .apply-btn:hover { background: #172554; }
        .clear-btn { background: var(--border); color: var(--text-light); }

        .active-range {
            background: #dbeafe;
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 16px;
            display: inline-block;
        }
        .dark-mode .active-range { background: #1e3a8a; color: white; }

        .section-header {
            font-size: 1.7rem;
            font-weight: 700;
            margin: 40px 0 20px;
            color: var(--primary);
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-light);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--card);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .metric-card h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-light);
            font-weight: 700;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            font-size: 1.05rem;
        }
        .metric-row:last-child { border-bottom: none; }
        .metric-label { color: var(--text-light); font-weight: 500; }
        .metric-value {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text);
            font-variant-numeric: tabular-nums;
        }

        .total-row {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 3px solid var(--primary);
            font-size: 1.1rem;
        }
        .total-row .metric-label { font-weight: 700; color: var(--primary); }
        .total-row .metric-value { font-size: 1.8rem; }

        .highlight-card {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            grid-column: 1 / -1;
        }
        .highlight-card h2 { color: white; border-color: rgba(255,255,255,0.3); }
        .highlight-card .metric-label { color: rgba(255,255,255,0.9); }
        .highlight-card .metric-value { color: white; }
        .big-number {
            font-size: 4.5rem;
            font-weight: 900;
            text-align: center;
            margin: 30px 0;
            line-height: 1;
        }
        .big-label { text-align: center; font-size: 1.3rem; opacity: 0.95; }

        .chart-container {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }
        .chart-container h2 { 
            color: var(--primary); 
            margin-bottom: 24px; 
            font-size: 1.6rem;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 1.05rem;
        }
        .comparison-table th {
            background: var(--bg);
            color: var(--primary);
            padding: 16px;
            text-align: left;
            font-weight: 600;
        }
        .comparison-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
        }
        .comparison-table tr:hover { background: rgba(30,58,138,.05); }
        .change-positive { color: #16a34a; font-weight: 600; }
        .change-negative { color: #dc2626; font-weight: 600; }

        .dashboard-footer {
            text-align: center;
            padding: 32px;
            color: var(--text-light);
            font-size: 0.95rem;
            border-top: 1px solid var(--border);
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }
        .loading::after {
            content: "Updating...";
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
            border-radius: 16px;
        }
        .dark-mode .loading::after { background: rgba(15,23,42,0.9); }

        @media (prefers-color-scheme: dark) {
            body:not(.light-mode) { --text: #f1f5f9; --bg: #0f172a; --card: #1e293b; }
        }
        @media print {
            body { background: white; padding: 0; }
            .header, .year-selector, .date-range-container, #themeToggle { display: none; }
            .metric-card, .chart-container { box-shadow: none; break-inside: avoid; page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="dashboard-container" id="main-content">
        <div class="header">
            <button id="themeToggle" aria-label="Toggle dark mode">Dark Mode</button>
            <h1>Fiscal Year Attendance Dashboard</h1>
            <p class="subtitle">Real-time metrics and trends across fiscal years</p>

            <div role="tablist" aria-label="Fiscal year selector" class="year-selector">
                <button role="tab" class="year-btn" data-fy="2023" onclick="selectFiscalYear(2023)">FY 2023</button>
                <button role="tab" class="year-btn" data-fy="2024" onclick="selectFiscalYear(2024)">FY 2024</button>
                <button role="tab" class="year-btn active" data-fy="2025" onclick="selectFiscalYear(2025)">FY 2025</button>
                <button role="tab" class="year-btn" data-fy="2026" onclick="selectFiscalYear(2026)">FY 2026</button>
            </div>

            <div class="date-range-container">
                <label class="date-range-label">Custom Range:</label>
                <input type="date" id="startDate" class="date-input">
                <span>to</span>
                <input type="date" id="endDate" class="date-input">
                <button class="apply-btn" onclick="applyCustomRange()">Apply</button>
                <button class="clear-btn" onclick="clearCustomRange()">Clear</button>
            </div>

            <div class="active-range" id="activeRange">
                Showing: FY 2025 (Jul 1, 2024 – Jun 30, 2025)
            </div>
        </div>

        <!-- Average Weekly Attendance -->
        <h2 class="section-header">Average Weekly Attendance</h2>
        <div class="metrics-grid">
            <div class="metric-card" role="region" aria-labelledby="aud-heading">
                <h2 id="aud-heading">Auditorium</h2>
                <div class="metric-row"><span class="metric-label">8:00am</span><span class="metric-value" id="aud-800">287</span></div>
                <div class="metric-row"><span class="metric-label">9:30am</span><span class="metric-value" id="aud-930">412</span></div>
                <div class="metric-row"><span class="metric-label">11:00am</span><span class="metric-value" id="aud-1100">523</span></div>
                <div class="metric-row"><span class="metric-label">12:30pm</span><span class="metric-value" id="aud-1230">198</span></div>
                <div class="metric-row total-row"><span class="metric-label">Weekly Average</span><span class="metric-value" id="aud-total">1,420</span></div>
            </div>

            <div class="metric-card" role="region" aria-labelledby="kids-heading">
                <h2 id="kids-heading">Birth – 6th Grade</h2>
                <div class="metric-row"><span class="metric-label">8:00am</span><span class="metric-value" id="kids-800">64</span></div>
                <div class="metric-row"><span class="metric-label">9:30am</span><span class="metric-value" id="kids-930">142</span></div>
                <div class="metric-row"><span class="metric-label">11:00am</span><span class="metric-value" id="kids-1100">189</span></div>
                <div class="metric-row"><span class="metric-label">12:30pm</span><span class="metric-value" id="kids-1230">73</span></div>
                <div class="metric-row total-row"><span class="metric-label">Weekly Average</span><span class="metric-value" id="kids-total">468</span></div>
            </div>

            <div class="metric-card" role="region" aria-labelledby="dt-heading">
                <h2 id="dt-heading">Dream Team Volunteers</h2>
                <div class="metric-row"><span class="metric-label">8:00am</span><span class="metric-value" id="dt-800">45</span></div>
                <div class="metric-row"><span class="metric-label">9:30am</span><span class="metric-value" id="dt-930">78</span></div>
                <div class="metric-row"><span class="metric-label">11:00am</span><span class="metric-value" id="dt-1100">92</span></div>
                <div class="metric-row"><span class="metric-label">12:30pm</span><span class="metric-value" id="dt-1230">38</span></div>
                <div class="metric-row total-row"><span class="metric-label">Weekly Average</span><span class="metric-value" id="dt-total">253</span></div>
            </div>

            <div class="metric-card highlight-card">
                <h2>Combined Weekly Average</h2>
                <div class="big-number" id="combined-total">2,141</div>
                <div class="big-label">Total People Per Week</div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <div class="metric-row"><span class="metric-label">Auditorium</span><span class="metric-value">1,420</span></div>
                    <div class="metric-row"><span class="metric-label">Birth – 6th Grade</span><span class="metric-value">468</span></div>
                    <div class="metric-row"><span class="metric-label">Dream Team</span><span class="metric-value">253</span></div>
                </div>
            </div>
        </div>

        <!-- Trend Chart with Chart.js -->
        <h2 class="section-header">Monthly Attendance Trend</h2>
        <div class="chart-container">
            <h2>Combined Weekly Average by Month</h2>
            <canvas id="attendanceTrendChart" height="120"></canvas>
        </div>

        <!-- Year-over-Year Comparison -->
        <h2 class="section-header">Year-Over-Year Comparison</h2>
        <div class="metric-card">
            <h2>Fiscal Year Comparison</h2>
            <table class="comparison-table" aria-label="Year over year metrics">
                <thead>
                    <tr><th>Metric</th><th>FY 2023</th><th>FY 2024</th><th>FY 2025</th><th>YoY Change</th></tr>
                </thead>
                <tbody id="yoy-table-body">
                    <!-- Filled by JS -->
                </tbody>
            </table>
        </div>

        <div class="dashboard-footer">
            <p><strong>Note:</strong> Live demo with mock data • Replace with Rock RMS queries for production</p>
            <p>Fiscal Year: July 1 – June 30 | Updated <span id="lastUpdated"></span></p>
        </div>
    </div>

    <script>
        const fiscalYears = {
            2023: { start: '2022-07-01', end: '2023-06-30', label: 'FY 2023 (Jul 1, 2022 – Jun 30, 2023)' },
            2024: { start: '2023-07-01', end: '2024-06-30', label: 'FY 2024 (Jul 1, 2023 – Jun 30, 2024)' },
            2025: { start: '2024-07-01', end: '2025-06-30', label: 'FY 2025 (Jul 1, 2024 – Jun 30, 2025)' },
            2026: { start: '2025-07-01', end: '2026-06-30', label: 'FY 2026 (Jul 1, 2025 – Jun 30, 2026)' }
        };

        const mockData = { /* same as your original – omitted for brevity but included below */ };

        // Paste your full mockData object here (same as before) for brevity I’ll just show the structure
        const mockData = {
            2023: { auditorium: {'800':245,'930':378,'1100':467,'1230':156,total:1246}, kids:{'800':52,'930':118,'1100':156,'1230':58,total:384}, dreamTeam:{'800':38,'930':65,'1100':78,'1230':32,total:213}, combined:1843, baptisms:156, ftgTotal:1245, onlineTotal:2456, ftgWeekly:24, trend:[1780,1820,1890,1920,1980,2040,1890,1910,1950,2010,1880,1790] },
            2024: { auditorium: {'800':268,'930':395,'1100':498,'1230':178,total:1339}, kids:{'800':58,'930':132,'1100':172,'1230':65,total:427}, dreamTeam:{'800':42,'930':72,'1100':86,'1230':35,total:235}, combined:2001, baptisms:178, ftgTotal:1312, onlineTotal:2234, ftgWeekly:25, trend:[1880,1920,2010,2050,2100,2180,1980,2020,2080,2140,2050,1920] },
            2025: { auditorium: {'800':287,'930':412,'1100':523,'1230':198,total:1420}, kids:{'800':64,'930':142,'1100':189,'1230':73,total:468}, dreamTeam:{'800':45,'930':78,'1100':92,'1230':38,total:253}, combined:2141, baptisms:198, ftgTotal:1383, onlineTotal:2081, ftgWeekly:27, trend:[1892,1945,2156,2089,2234,2387,2012,2098,2145,2267,2134,1978] },
            2026: { auditorium: {'800':295,'930':425,'1100':545,'1230':210,total:1475}, kids:{'800':68,'930':148,'1100':198,'1230':78,total:492}, dreamTeam:{'800':48,'930':82,'1100':98,'1230':42,total:270}, combined:2237, baptisms:215, ftgTotal:1456, onlineTotal:1987, ftgWeekly:28, trend:[1950,2000,2200,2150,2300,2450,2080,2150,2200,2320,2180,2020] }
        };

        let currentFY = 2025;
        let trendChart = null;

        function animateValue(el, start, end, duration = 800) {
            let startTime = null;
            const step = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);
                el.textContent = current.toLocaleString();
                if (progress < 1) requestAnimationFrame(step);
            };
            requestAnimationFrame(step);
        }

        function updateDashboardData(year) {
            document.body.classList.add('loading');
            setTimeout(() => {
                const d = mockData[year];
                // Animate numbers
                animateValue(document.getElementById('aud-800'), 0, d.auditorium['800']);
                animateValue(document.getElementById('aud-930'), 0, d.auditorium['930']);
                animateValue(document.getElementById('aud-1100'), 0, d.auditorium['1100']);
                animateValue(document.getElementById('aud-1230'), 0, d.auditorium['1230']);
                animateValue(document.getElementById('aud-total'), 0, d.auditorium.total);
                animateValue(document.getElementById('kids-800'), 0, d.kids['800']);
                animateValue(document.getElementById('kids-930'), 0, d.kids['930']);
                animateValue(document.getElementById('kids-1100'), 0, d.kids['1100']);
                animateValue(document.getElementById('kids-1230'), 0, d.kids['1230']);
                animateValue(document.getElementById('kids-total'), 0, d.kids.total);
                animateValue(document.getElementById('dt-800'), 0, d.dreamTeam['800']);
                animateValue(document.getElementById('dt-930'), 0, d.dreamTeam['930']);
                animateValue(document.getElementById('dt-1100'), 0, d.dreamTeam['1100']);
                animateValue(document.getElementById('dt-1230'), 0, d.dreamTeam['1230']);
                animateValue(document.getElementById('dt-total'), 0, d.dreamTeam.total);
                animateValue(document.getElementById('combined-total'), 0, d.combined);

                updateTrendChart(year);
                updateYoYTable(year);
                document.body.classList.remove('loading');
            }, 300);
        }

        function updateTrendChart(year) {
            const ctx = document.getElementById('attendanceTrendChart').getContext('2d');
            if (trendChart) trendChart.destroy();
            trendChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jul','Aug','Sep','Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun'],
                    datasets: [{
                        label: 'Weekly Avg',
                        data: mockData[year].trend,
                        backgroundColor: '#1e3a8a',
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { callback: v => v.toLocaleString() } }
                    }
                }
            });
        }

        function updateYoYTable(currentYear) {
            const rows = [
                { label: "Avg Weekly Attendance", key: "combined" },
                { label: "Total Baptisms", key: "baptisms" },
                { label: "Total First Time Guests", key: "ftgTotal" },
                { label: "Avg Weekly Online", key: "onlineTotal" },
                { label: "Avg Weekly FTG", key: "ftgWeekly" }
            ];
            const tbody = document.getElementById('yoy-table-body');
            tbody.innerHTML = '';
            rows.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${row.label}</td>
                    <td>${mockData[2023][row.key].toLocaleString()}</td>
                    <td>${mockData[2024][row.key].toLocaleString()}</td>
                    <td><strong>${mockData[currentYear][row.key].toLocaleString()}</strong></td>
                    <td class="${mockData[currentYear][row.key] > mockData[2024][row.key] ? 'change-positive' : 'change-negative'}">
                        ${((mockData[currentYear][row.key] / mockData[2024][row.key] - 1)*100).toFixed(1)}%
                    </td>`;
                tbody.appendChild(tr);
            });
        }

        // Rest of your functions (selectFiscalYear, applyCustomRange, etc.) remain exactly the same
        // ... (copy them from your original code)

        // Dark mode
        const toggle = document.getElementById('themeToggle');
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark-mode');
            toggle.textContent = 'Light Mode';
        } else {
            toggle.textContent = 'Dark Mode';
        }
        toggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            toggle.textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
        });

        // Init
        document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
        updateDashboardData(2025);
        updateTrendChart(2025);
    </script>
</body>
</html>